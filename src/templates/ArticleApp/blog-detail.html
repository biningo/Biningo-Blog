{% extends "base.html" %}
{% block keyword %}
    <meta content="{{ article.title }}" name="keywords">
{% endblock %}
{% block title %}
    {{ article.title }}
{% endblock %}

{% block css %}
<link rel="stylesheet" href="/static/editormd/css/editormd.css" />
<link rel="stylesheet" href="/static/my/css/blog-list.css">

    <!--[if lt IE 9]>
<script type="text/javascript" src="/staticRes/js/html5shiv.js"></script>
<script type="text/javascript" src="/staticRes/js/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="/static/plugin/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="/static/plugin/Hui-iconfont/1.0.8/iconfont.min.css" />
<link rel="stylesheet" type="text/css" href="/static/css/common.css" />
<link rel="stylesheet" type="text/css" href="/static/plugin/pifu/pifu.css" />
<link rel="stylesheet" type="text/css" href="/static/plugin/wangEditor/css/wangEditor.min.css">
<!--[if lt IE 9]>
<link href="/staticRes/lib/h-ui/css/H-ui.ie.css" rel="stylesheet" type="text/css" />
<![endif]-->

{% endblock css %}

{% block body %}

<textarea id="content"  style="display: none">{{ article.content_html }}</textarea>

<div class="layui-container" style="">

<!--正文-->
<div  class="layui-row" style="background-color: white;padding-bottom: 20px;">

<div >
<blockquote style="background-color:honeydew" class="layui-elem-quote"><h6 style="font-family: 楷体;font-size: 15px;" class="ctitle"><span style="font-family: 楷体;font-weight: bolder;font-size: 15px;">不要轻易放弃。学习成长的路上，我们长路漫漫，只因学无止境。</span><br>
        <span style="margin-left: 50%;" >----biningo</span></h6>
</blockquote>
</div>
    <div  class="layui-container">

        <h1 style="font-family: 华文楷体;text-align: center">{{ article.title }}</h1>
       <div> <p style="text-align: center;margin-bottom: 30px;">

            {% if article.copyright %}
            <span style="margin-left: 5px;color: green" class="layui-badge layui-bg-green">原创</span>
                {% else %}
                 <span style="margin-left: 5px;color: green" class="layui-badge layui-bg-red">转载</span>
            {% endif %}

            <span style="margin-left: 5px;" class="layui-icon layui-icon-date"></span>{{ article.created_time|date:"Y-m-d"}}

        <span style="margin-left: 5px;" class="layui-icon layui-icon-friends"></span>biningo
        <span style="margin-left: 10px;" class="layui-icon layui layui-icon-template-1"></span><a href="/article/category/{{ article.category.name }}/">{{ article.category.name }}</a>
<span >

   <span style="margin-left: 10px;" class="layui-icon layui-icon-read">{{ article.access_count }}</span>

<span class="layui-icon layui-icon-face-surprised"></span>

</span>
        </p> </div>


        <div style="margin-left: 10%;margin-right: 10%;">
            <div  id="result" style="font-size: larger" ></div>
        </div>



    </div>

</div>
<!--正文-->

<div >
<div class="layui-row" style="text-align: center;margin-top: 20px;">
    <span class="layui-icon layui-icon-loading" style="font-size: 30px;">完</span>
</div>

<div  style="margin-top: 20px;" class="layui-row">
<div class="layui-col-md6">
    <blockquote  style="width: 100%;background-color:white;" class="layui-elem-quote layui-quote-nm">

        <p style="font-size: 12px;"><b>作者：</b><a href="/my_space/index/">biningo</a></p>
        <p style="font-size: 12px;" ><b>原文链接:</b><a style="color: #007bff" href="/article/detail/{{ article.created_time|date:'Y' }}/{{ article.created_time|date:'m'}}/{{ article.id}}/">http://www.binnb.com/article/detail/{{ article.created_time|date:'Y' }}/{{ article.created_time|date:'m'}}/{{ article.id}}/</a> </p>

        <p style="font-size: 12px;" ><b>版权声明:</b>本博客所有文章除特别声明外，均采用<a style="color: #007bff" rel="license" href="http://creativecommons.org/licenses/by/3.0/cn/"> CC BY 3.0 CN协议</a>进行许可。转载请署名作者且注明文章出处。文章来着原创、转载,属于个人观点,如有勘误,欢迎交流</p>
</blockquote>
</div>
</div>


<div class="layui-row">
    {% for tag in article.tags.all %}
    <span class="layui-icon layui-icon-note"><a href="/article/tag/{{ tag.name }}/">{{ tag.name }}</a></span>
    {% endfor %}
</div>
<hr style="margin-bottom: 5px;" class="layui-bg-green">
<div class="layui-row" style="margin: 10px;">

{% if pre_article %}
<a href="/article/detail/{{ pre_article.created_time|date:'Y' }}/{{ pre_article.created_time|date:'m'}}/{{ pre_article.id}}/">
<span class="layui-icon layui-icon-prev"></span>{{ pre_article.title }}
</a>
{% endif %}

{% if next_article %}
 <a href="/article/detail/{{ next_article.created_time|date:'Y' }}/{{ next_article.created_time|date:'m'}}/{{ next_article.id}}/">
<span style="float:right">
    {{ next_article.title }}
<span class="layui-icon layui-icon-next" ></span>
</span>
</a>
{% endif %}


</div>


<div class="layui-row">

    <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"24"},"share":{},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>


</div> <!--分享功能-->

</div> <!--文章尾部信息声明-->



<div class="layui-container" style="margin-top: 90px;">

    <div class="layui-col-md8">

    <div class="panel panel-default  mb-20">
						<div class="tab-category">
                <a href=""><strong>评论区</strong></a>
            </div>



<div class="panel-body">

<div class="layui-row" style="margin-top: 10px;">
    <div class="layui-container">

         {% if user_account.email %}
             <span  id="user">{{ user_account.username }} 您好！</span>
         {% else %}
             <span id="user">请先登录再评论</span>
         <div id="login_register">

            <button id="register_btn" data-method="offset" data-type="auto" class="register layui-btn  layui-btn-sm layui-btn-normal">注册</button>
        <button id="login_btn" data-method="offset" data-type="auto" class="login layui-btn  layui-btn-sm layui-btn-normal">登陆</button>

         </div>
     {% endif %}
    </div>

</div> <!--用户登录及其验证-->
     <!--用于评论-->
        <div class="mt-20" id="ct">

            <form  method="post"  id="note" class="layui-form layui-form-pane" >
<input hidden name="article_id" value="{{ article.id }}" >
 <textarea id="textarea1" name="content" style="height:200px;" placeholder="看完不留一发？"> </textarea>
            <div class="text-r mt-10">
                <button  type="button" onclick="NoteCommit()" class="btn btn-primary radius" > 留言</button>
            </div>
</form>




        </div>


<div>
        <ul class="commentList mt-50">

       {% for comment in comment_list %}
           {% ifequal comment.father_comment null %}
          <li class="item cl"> <a href="#"><i class="avatar size-L radius"><img alt="" src="/static/images/touxiang.png"></i></a>
                <div class="comment-main">
                    <header class="comment-header">
                        <div class="comment-meta"><a class="comment-author" href="#">{{ comment.user.username}}</a>
                            <time  class="f-r">{{ comment.created_time | date:"Y-m-d" }}</time>
                        </div>
                    </header>
                    <div class="comment-body">
                        {{ comment.content|safe }}

                        <ul  class="commentList">

{% for resp in comment.articlecomment_set.all %}

                            <li class="item cl"> <a href="#"><i class="avatar size-L radius"><img alt="" src="/static/images/touxiang.png"></i></a>
                                <div class="comment-main">
                                    <header class="comment-header">
                                        <div class="comment-meta"><a class="comment-author" href="#">#{{ resp.user.username}}</a>
                                            <time  class="f-r">{{ resp.created_time|date:'Y-m-d' }}</time>
                                        </div>
                                    </header>
                                    <div class="comment-body">
                                        <p>{{ resp.content }}</p>
                                    </div>
                                </div>
                            </li>
{% endfor %}

                        </ul>

                        <button class="hf f-r btn btn-default size-S mt-10" name={{ comment.id }} style="display: block;">回复</button>

                    </div>
                </div>
            </li>
           {% endifequal %}
        {% endfor %}

        </ul> <!--评论展示-->

</div> <!--一评论展示-->



 <!--用于回复框-->
        <div class="comment hidden mt-20">
           <form method="post">
    <input hidden name="article_id" value="{{ article.id }}" >
            <textarea name="content" class="textarea" style="height:100px;"> </textarea>
            <button  onclick="NoteResp()" type="button" class="btn btn-primary radius mt-10">回复</button>
            <a class="cancelReply f-r mt-10">取消回复</a>
           </form>
        </div>
</div>


	</div>

    </div>

</div><!--评论区-->







</div>

{% endblock body %}

{% block js %}
<script>


    function compile() {

        //获取要转换的文字
        var text = document.getElementById("content").value;
        //创建实例

        var converter = new showdown.Converter();
        //进行转换

        var html = converter.makeHtml(text);
        //展示到对应的地方  result便是id名称

        document.getElementById("result").innerHTML = html;
    }
    setTimeout(compile,500);


   // document.getElementsByTagName("body")[0].style.backgroundColor ="#FFFFFF";


</script> <!--转换-->
<script src="https://cdn.bootcss.com/showdown/1.3.0/showdown.min.js"></script>
<script src="https://lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script>
<script src="https://lib.baomitu.com/underscore.js/1.9.1/underscore-min.js"></script>

<script>
layui.use(['form', 'layedit', 'laydate'], function(){});



    </script> <!--layui-->


<script>
layui.use('layer', function(){ //独立版的layer无需执行这一句
  var $ = layui.jquery, layer = layui.layer; //独立版的layer无需执行这一句

  //触发事件
  var active = {

    offset: function(othis){
      var type = othis.data('type')
      ,text = othis.text();

      layer.open({
        type: 1
        ,offset: type //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset

        ,content:'<div style="padding:20px;"><form  method="post"  id="login" class="layui-form" action="/user/login/">' +
                  ' <div class="layui-form-item">\n' +
              '    <label class="layui-form-label">email:</label>\n' +
              '    <div class="layui-input-inline">\n' +
              '      <input type="text" name="email" required lay-verify="required" placeholder="请输入邮箱" autocomplete="off" class="layui-input">\n' +
              '    </div>\n' +
              '  </div>'+
              '<div class="layui-form-item">\n' +
              '    <label class="layui-form-label">验证码:</label>\n' +
              '    <div class="layui-input-inline">\n' +
              '      <input type="text" id="captcha" name="captcha" required lay-verify="required" placeholder="请输入邮箱验证码" autocomplete="off" class="layui-input"><button id="captcha" name="login"  onclick="Captcha(this.name)" class="layui-btn layui-btn-primary">获取</button>\n' +
              '    </div>\n' +
              '<div class="layui-form-item">'+
              '<input type="submit" class="layui-btn" value="登录" lay-submit=""  />'+
              '</div>'
        ,btn: ''
        ,btnAlign: 'r' //按钮居中
        ,shade: 0 //不显示遮罩



      });
    }
  };

  $('#login_register .login').on('click', function(){
    var othis = $(this), method = othis.data('method');
    active[method] ? active[method].call(this, othis) : '';
  });

});<!--登录模态-->
layui.use('layer', function(){ //独立版的layer无需执行这一句
  var $ = layui.jquery, layer = layui.layer; //独立版的layer无需执行这一句

  //触发事件
  var active = {

    offset: function(othis){
      var type = othis.data('type')
      ,text = othis.text();

      layer.open({
        type: 1
        ,offset: type //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
        ,id: 'register'+type //防止重复弹出
        ,content:'<div style="padding:20px;"><form  method="post" onsubmit="Register_Login(this.id)" id="register" class="layui-form" >' +
                ' <div class="layui-form-item">\n' +
              '    <label class="layui-form-label">username:</label>\n' +
              '    <div class="layui-input-inline">\n' +
              '      <input type="text" name="username" required lay-verify="required" placeholder="请输入用户名" autocomplete="off" class="layui-input">\n' +
              '    </div>\n' +
              '  </div>'+
                  ' <div class="layui-form-item">\n' +
              '    <label class="layui-form-label">email:</label>\n' +
              '    <div class="layui-input-inline">\n' +
              '      <input type="text" name="email" required lay-verify="required" placeholder="请输入邮箱" autocomplete="off" class="layui-input">\n' +
              '    </div>\n' +
              '  </div>'+
              '<div class="layui-form-item">\n' +
              '    <label class="layui-form-label">验证码:</label>\n' +
              '    <div class="layui-input-inline">\n' +
              '      <input type="text" id="captcha" name="captcha" required lay-verify="required" placeholder="请输入邮箱验证码" autocomplete="off" class="layui-input"><button id="captcha" name="register" onclick="Captcha(this.name)" class="layui-btn layui-btn-primary">获取</button>\n' +
              '    </div>\n' +
              '<div class="layui-form-item">'+
              '<input type="submit" class="layui-btn" value="注册" lay-submit=""  />'+
              '</div>'

        ,btnAlign: 'c' //按钮居中
        ,shade: 0 //不显示遮罩

      });
    }
  };

  $('#login_register .register').on('click', function(){
    var othis = $(this), method = othis.data('method');
    active[method] ? active[method].call(this, othis) : '';
  });

});<!--注册模态-->

function Register_Login(id) {
    var form =  new FormData(document.getElementById(id));
    ajax = new XMLHttpRequest();
    ajax.open("post","/user/captcha/",true);
    if (id==="register")
        ajax.open("post","/user/register/",true);
    else
        ajax.open("post","/user/login",true);

    ajax.onload = function(){
      alert(ajax.responseText);
    };

    ajax.send(form);
}


function Captcha(id) {

     var form =  new FormData(document.getElementById(id));
     if(!form.get("email"))
     {
         alert("邮箱为空!");
     }else
     {
         document.getElementById("captcha").innerText = "重新获取";
         ajax = new XMLHttpRequest();

     ajax.open("post","/user/captcha/",true);
     ajax.onload = function(){

         alert("邮件发送成功！\n若无法收到邮件请到垃圾箱查看 或检查邮箱是否正确!");};  //读取数据成功之后

     ajax.send(form);
     }



}

</script><!--用户登录-->

<!--=====================-->
    <script type="text/javascript" src="/static/plugin/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="/static/plugin/layer/3.0/layer.js"></script>
<script type="text/javascript" src="/static/plugin/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="/static/plugin/pifu/pifu.js"></script>
<script type="text/javascript" src="/static/js/common.js"></script>

<script type="text/javascript" src="/static/plugin/wangEditor/js/wangEditor.min.js"></script>
<script type="text/javascript">
    $(function () {
    		$("img.lazyload").lazyload({failurelimit : 3});

        wangEditor.config.printLog = false;
        var editor1 = new wangEditor('textarea1');
        editor1.config.menus = ['insertcode', 'quote', 'bold', '|', 'img', 'emotion', '|', 'undo', 'fullscreen'];
        editor1.config.emotions = { 'default': { title: '表情', data: '/static/plugin/wangEditor/emotions1.data'}, 'default2': { title: '心情', data: '/static/plugin/wangEditor/emotions3.data'}, 'default3': { title: '顶一顶', data: '/static/plugin/wangEditor/emotions2.data'}};
        editor1.create();

        //show reply
        $(".hf").click(function () {
            pId = $(this).attr("name");

            $(this).parents(".commentList").find(".cancelReply").trigger("click");
            $(this).parent(".comment-body").append($(".comment").clone(true));
            $(this).parent(".comment-body").find(".comment").removeClass("hidden");
            $(this).parent(".comment-body").find(".comment").addClass(pId.toString());
            $(this).parent(".comment-body").find(".comment").addClass("resp");
            $(this).hide();
        });
        //cancel reply
        $(".cancelReply").on('click',function () {
            $(this).parents(".comment-body").find(".hf").show();
            $(this).parents(".comment-body").find(".comment").remove();
        });
    });

</script>


      <script>

    function NoteCommit() {

        if(document.getElementById('user').innerText!=='请先登录再评论')
        {

              var form =  new FormData(document.getElementById('note'));


             ajax = new XMLHttpRequest();

             ajax.open("post", "/article/comment/", true);
             ajax.onload = function () {
                layer.msg("评论成功");
                setTimeout( function()
                {
                window.location.reload();
                   }
             ,2000)
             };

                 ajax.send(form);

        }
        else
        {

            layer.msg("请先登录");
        }




    }

function NoteResp() {

   if(document.getElementById('user').innerText!=='请先登录再评论')
   {

     var form =  new FormData(document.getElementsByClassName("resp")[0].getElementsByTagName('form')[0]);


             ajax = new XMLHttpRequest();

             ajax.open("post", "/article/comment/", true);
             ajax.onload = function () {
                layer.msg("回复成功");
                setTimeout( function()
                {
                window.location.reload();
                   }
             ,2000)
             };
             var note_id = document.getElementsByClassName("resp")[0].classList[2];
                form.append("comment_id",note_id);
                 ajax.send(form);

        }
        else
        {

            layer.msg("请先登录");
        }






}

    </script>
{% endblock js %}


